{% extends "menubarra.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% block styles %}
  {{super()}}
  
<!-- 
  <link href="{{ url_for('static', filename='lib/bootstrap/css/bootstrap.min.css')}}" rel="stylesheet"> -->
  <link href="{{ url_for('static', filename='lib/font-awesome/css/font-awesome.css')}}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='lib/bootstrap-fileupload/bootstrap-fileupload.css')}}" rel="stylesheet" />
  <meta name="viewport" content="initial-scale=1.0, width=device-width" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
  
  {% endblock %}
 
{% block main %} 
    <!--main content start-->    
    <section id="main-content">
      <section class="wrapper">
        {% if notificacion  %}
        <br>
          {% if 'exitosamente' in notificacion %}
          <div class="alert alert-success alert-dismissible" role="alert">
          {% else %}
          <div class="alert alert-danger alert-dismissible" role="alert">
          {% endif %}
          {{notificacion}}
           <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
           </button>
        </div>
        {% endif %}
        <h3><i class="fa fa-angle-right"></i> Alta de Centro</h3>

        <!-- /row -->
        <div class="row mt" style="height: 100vh;">
          <div class="col-lg-12">
            <h4><i class="fa fa-angle-right"></i>Registrar</h4>
            <div class="form-panel">
              <div class="form">
                <form class="cmxform form-horizontal style-form" id="signupForm" >
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                  <div class="form-group ">
                    <label for="nombre" class="control-label col-lg-2">Nombre</label>
                    <div class="col-lg-10">
                      {% if centro_data %}
                      <input class=" form-control" id="nombre" name="nombre" type="text" required value="{{centro_data.get('nombre')}}"/>
                      {% else %}
                      <input class=" form-control" id="nombre" name="nombre" type="text" required/>
                      {%endif%}
                    </div>
                  </div>
                  
                  <div class="form-group ">
                    <label for="telefono" class="control-label col-lg-2">Telefono</label>
                    <div class="col-lg-10">
                      {% if centro_data %}
                      <input class=" form-control" id="telefono" name="telefono" type="text" required  value="{{centro_data.get('telefono')}}"/>
                      {% else %}
                      <input class=" form-control" id="telefono" name="telefono" type="text" required />
                      {% endif %}
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-lg-2">Franja Horaria Desde</label>
                    <div class="col-lg-5">
                      <div class="input-group date">
                        <div class="input-group" id="hora_apertura">
                          <input type="time" class="form-control timepicker-default dpd1" id="input_hora_apertura" required>
                          <span class="input-group-btn">
                            <button class="btn btn-theme04" type="button"><i class="fa fa-clock-o"></i></button>
                            </span>
                        </div>
                        <span class="input-group-addon">Hasta</span>
                        <div class="input-group " id="hora_cierre">
                          <input type="time" class="form-control timepicker-default dpd2" id="input_hora_cierre" name="hora_cierre" required>
                          <span class="input-group-btn">
                            <button class="btn btn-theme04" type="button"><i class="fa fa-clock-o"></i></button>
                            </span>
                        </div>
                      </div>
                      <span class="help-block">Selecciona un horario</span>
                    </div>
                  </div>

                  <div class="form-group ">
                    <label for="id_tipo_centro" class="control-label col-lg-2">Tipo</label>
                    <div class="col-lg-10">
                      {% if centro_data  %}
                      <input class="form-control " id="id_tipo_centro" name="id_tipo_centro" type="text" required value="{{centro_data.get('id_tipo_centro')}}"/>
                      {% else %}
                      <input class="form-control " id="id_tipo_centro" name="id_tipo_centro" type="text" required/>
                      {% endif %}
                    </div>
                  </div>
                  <div class="form-group ">
                    <label for="sitio_web" class="control-label col-lg-2">Sitio Web</label>
                    <div class="col-lg-10">
                      {% if centro_data  %}
                      <input class="form-control " id="sitio_web" name="sitio_web" type="text" required value="{{centro_data.get('sitio_web')}}"/>
                      {% else %}
                      <input class="form-control " id="sitio_web" name="sitio_web" type="text" required/>
                      {% endif %}
                    </div>
                  </div>
                  
                  <div class="form-group ">
                    <label for="email" class="control-label col-lg-2">Email</label>
                    <div class="col-lg-10">
                      {% if centro_data and ('email' not in notificacion)  %}
                      <input class="form-control " id="email" name="email" type="email" required value="{{centro_data.get('email')}}" />
                      {% else %}
                      <input class="form-control " id="email" name="email" type="email" required/>
                      {% endif %}
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label col-lg-2">Archivo</label>
                    <div class="controls col-lg-10">
                      <div class="fileupload fileupload-new" data-provides="fileupload">
                        <span class="btn btn-theme02 btn-file">
                          <span class="fileupload-new"><i class="fa fa-paperclip"></i> Selecciona un PDF</span>
                        <span class="fileupload-exists"><i class="fa fa-undo"></i> Cambiar</span>
                        <input type="file" class="default" />
                        </span>
                        <span class="fileupload-preview" style="margin-left:5px;"></span>
                        <a href="advanced_form_components.html#" class="close fileupload-exists" data-dismiss="fileupload" style="float: none; margin-left:5px;"></a>
                      </div>
                    </div>
                  </div>
                  <div class="form-group ">
                    <label for="municipio" class="control-label col-lg-2">Municipio</label>
                    <div class="col-lg-10">

                        <select id="municipio" name="municipio" class="form-control" >
                          {%for municipio in municipios %}
                          <option  value="{{municipio}}">{{ municipio }}</option> 
                          {% endfor %}
                        </select>
                    </div>
                  </div>

                  <div class="form-group ">
                    <label for="calleynumero" class="control-label col-lg-2">Calle y Numero</label>
                    <div class="col-lg-10">
                      {% if centro_data %}
                      <input class=" form-control" id="calleynumero" name="calleynumero" type="text" required  value="{{centro_data.get('calleynumero')}}"/>
                      {% else %}
                      <input class=" form-control" id="calleynumero" name="calleynumero" type="text" required />
                      
                      {% endif %}
                      <div class="panel-body">
                        <div id="mapid" style="height: 380px; "></div>
                      </div>
                    </div>
                  </div>
                  <input type="hidden" name="estado" value="En confirmacion"
                
                  <div class="form-group">
                    <div class="col-lg-offset-2 col-lg-10">
                      <button class="btn btn-theme04" type="button">Cancelar</button>
                    </div>
                  </div>
                </form>
                <button class="btn btn-theme" id="createButton" onclick="crearCentro()" >Crear</button>
                <button onclick="buscarDireccion()">test</button>
              </div>
            </div>
            <!-- /form-panel -->
       
          </div>
          
          <!-- /col-lg-12 -->
        </div>
        <!-- /row -->
      </section>
      <!-- /wrapper -->
    </section>


    <!--main content end-->

{% endblock %}

{% block scripts %}  
    <!-- js placed at the end of the document so the pages load faster -->
    
    <script src="{{ url_for('static', filename='lib/common-scripts.js')}}"></script>
    <script src="{{ url_for('static', filename='lib/bootstrap-fileupload/bootstrap-fileupload.js')}}"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js"type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js"type="text/javascript" charset="utf-8"></script>

    <script src="http://www.openlayers.org/api/OpenLayers.js"></script>
    <script>
      $('#hora_apertura').datetimepicker({
          format: 'hh:mm',
          stepping: 30,
      });
    </script>
    
    <script>
      $('#hora_cierre').datetimepicker({
          format: 'hh:mm',
          stepping: 30,
      });
     
  </script>

   <!-- Make sure you put this AFTER Leaflet's CSS -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>

  <script>
   var mymap = L.map('mapid').setView([-37.3121792,-61.3996217], 6);
   L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'sk.eyJ1Ijoibmljb3hyb2xsIiwiYSI6ImNraDVjajM2YjBrMW4yem92dzBpY3I2enMifQ.5RbMt9SNX0EQuk9VHVszFg'
  }).addTo(mymap);


 </script>
 <script>

   function buscarDireccion() {

    var dataDir = encodeURI(document.getElementById("calleynumero").value + ', Municipio ' +document.getElementById('municipio').value +', Provincia de Buenos Aires, Argentina') 
    fetch('https://geocode.search.hereapi.com/v1/geocode?apikey=s0gvC3NKNulSUn6DSTyhf4jCcwVL5TN7C5oBELvwf3I&q='+ dataDir)
    .then(response => response.json())
    .then(data => {
      var lat = data['items'][0]['position']['lat'];
      var lng = data['items'][0]['position']['lng'];
      var newMarker = L.marker([lat, lng], {draggable:'true'}).addTo(mymap).bindPopup('Vas agregarlo en las siguientes coordenadas: latitud = '+lat+' longitud = '+lng+'" </a>').openPopup();
      mymap.setView([lat, lng],18)
      console.log(data);
    })
       // The function returns the product of p1 and p2
  }
/* 
   eventTarget.addEventListener("keyup", event => {
     
    if (event.isComposing || event.keyCode === 229) {
    return;
  } */
  // do something

 </script>
 <script>

   function crearCentro(){
    const formData = new FormData();
    formData.append('nombre', $('#nombre').val());
    formData.append('telefono', $('#telefono').val());
    formData.append('hora_apertura',  $('#input_hora_apertura').val());
    formData.append('hora_cierre',  $('#input_hora_cierre').val());
    formData.append('tipo', $("#id_tipo_centro").val());
    formData.append('email', $("#email").val());
    formData.append('sitio_web', $('#sitio_web').val());
    formData.append('direccion', $('#calleynumero').val());
    //formData.append('estado', $('#estado').val());

    axios.post('/api/centros', formData,{
      headers: {
          'Content-Type': 'multipart/form-data'
        }
    }).then(function (response) {
      console.log(response);
    })
    .catch(function (error) {
      console.log(error);
    });;
};
 </script>



{% endblock %}
